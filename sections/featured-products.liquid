{% for block in section.blocks %}
  <section class="section-padding" {{ block.shopify_attributes }}>
    <div class="custom-container">
      <h2 class="text-center">{{ block.settings.heading }}</h2>
      <div class="row g-4 pt-5">
        {% for product in block.settings.collection.products limit: 4 %}
          <div class="col-lg-3 col-md-4 col-sm-6 col-12 pt-3">
            <div class="product-container">
              <a href="{{ product.url }}">
                <div class="prod-image">
                  <img
                    loading="lazy"
                    src="{{ product.featured_image | image_url }}"
                    width="250"
                    height="225"
                    alt="{{ product.title }}" />
                  {% unless product.available %}
                    <span class="out-of-stock-badge">Out of Stock</span>
                  {% endunless %}
                </div>
              </a>
              <div class="prod-info">
                <p id="title">{{ product.title }}</p>
                <div class="d-flex align-items-md-center align-items-start justify-content-between">
                  <h3 class="fw-bold" id="price">{{ product.price | money }}
                    {% assign pieces_per_pack = product.metafields.custom.pieces_per_pack | default: 1 %}
                    {% if pieces_per_pack > 1 %}
                      {% case product.type %}
                        {% when 'Roll' %}
                          {% assign unit_label = 'roll' %}
                        {% when 'Sheet' %}
                          {% assign unit_label = 'sheet' %}
                        {% when 'Bundle' %}
                          {% assign unit_label = 'bundle' %}
                        {% else %}
                          {% assign unit_label = 'piece' %}
                      {% endcase %}
                      <span class="perPiece pb-2">({{ product.price | divided_by: pieces_per_pack | money }}) per {{ unit_label }}</span>
                    {% endif %}
                  </h3>
                  <form class="add-to-cart-form prod-card" data-variant-id="{{ product.variants.first.id }}">
                    <button
                      type="submit"
                      class="funnel-font fw-bold"
                      {% unless product.available %}
                      disabled{% endunless %}
                      aria-label="{% if product.available %}Add {{ product.title }} to cart{% else %}Out of Stock{% endif %}">
                      {% if product.available %}
                        + Add to cart
                      {% else %}
                        Out of Stock
                      {% endif %}
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}

        <div class="col-12 d-flex justify-content-center">
          {% if block.settings.button_link != blank %}
            <a href="{{ block.settings.button_link }}" class="pt-5">
              <button class="btn-main">{{ block.settings.button_text }}</button>
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
{% endfor %}

{% schema %}
  {
    "name": "Featured Products",
    "tag": "div",
    "class": "featured-products-section",
    "blocks": [
      {
        "type": "collection",
        "name": "Collection",
        "limit": 5,
        "settings": [
          {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "Shop our products"
          },
          {
            "type": "collection",
            "id": "collection",
            "label": "Select Collection"
          },
          {
            "type": "text",
            "id": "button_text",
            "label": "Button Text",
            "default": "See all Products"
          },
          {
            "type": "url",
            "id": "button_link",
            "label": "Button Link"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Featured Products",
        "blocks": [
          {
            "type": "collection"
          }
        ]
      }
    ]
  }
{% endschema %}