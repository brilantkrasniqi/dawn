{% section 'page-title' %}

<div class="section">
  <div class="custom-container bg-gray  py-3">
    {% section 'collection-nav' %}
  </div>
</div>

<section class="" id="productSection">
  <div class="custom-container">
    {% assign sort_by = request.parameters.sort_by | default: 'manual' %}
      <div class="d-flex align-items-center justify-content-between">
      <div class="col-sm-4 col-0"></div>
      {% comment %} <h2 class="text-sm-center text-start col-sm-4 col-6">{{ collection.title }}</h2> {% endcomment %}
      <div class="col-sm-4 col-6 text-end">
        <!-- Sort selector removed as requested -->
      </div>
    </div>

    {% paginate collection.products by 12 %}
      <div class="row pt-sm-5 pt-3">
        {% for product in collection.products %}
          <div class="col-lg-3 col-md-4 col-sm-6 col-6 pt-3">
            <div class="product-container">
              <a href="{{ product.url }}">
                <div class="prod-image">
                  <img
                    loading="lazy"
                    src="{{ product.featured_image | image_url }}"
                    width="250"
                    height="225"
                    alt="{{ product.title }}" />
                  {% unless product.available %}
                    <span class="out-of-stock-badge">Out of Stock</span>
                  {% endunless %}
                  {% if product.compare_at_price > product.price %}
                    <span class="sale-badge">Sale</span>
                  {% endif %}
                </div>
              </a>
              <div class="prod-info">
                <p id="title">{{ product.title }}</p>
                <div class="d-flex flex-sm-row flex-column align-items-md-center align-items-start justify-content-between">
                  <div>
                    <div class="d-flex align-items-center">
                      <h3 class="fw-bold" id="price">{{ product.price | money }}
                        {% assign pieces_per_pack = product.metafields.custom.pieces_per_pack | default: 1 %}
                      </h3>
                      {% if product.compare_at_price > product.price %}
                        <p class="card-compare-price ps-2">{{ product.compare_at_price | money }}</p>
                      {% endif %}
                    </div>
                    {% if pieces_per_pack > 1 %}
                      {% case product.type %}
                        {% when 'Roll' %}
                          {% assign unit_label = 'roll' %}
                        {% when 'Sheet' %}
                          {% assign unit_label = 'sheet' %}
                        {% when 'Bundle' %}
                          {% assign unit_label = 'bundle' %}
                        {% else %}
                          {% assign unit_label = product.type %}
                      {% endcase %}
                      <p class="perPiece pb-2">({{ product.price | divided_by: pieces_per_pack | money }}) per {{ unit_label }}</p>
                    {% endif %}
                  </div>
                  <form class="add-to-cart-form prod-card" data-variant-id="{{ product.variants.first.id }}">
                    <button
                      type="submit"
                      class="funnel-font fw-bold d-sm-block d-none"
                      aria-label="Add {{ product.title }} to cart">
                      + Add to cart
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="col-12 d-flex justify-content-center">
        <div class="paginationContainer pt-md-5 pt-3">
          <div class="custom-pagination">
            {% if paginate.previous %}
              <a
                href="{{ paginate.previous.url }}"
                class="prev"
                aria-label="Previous"><img
                  src="{{'left-arrow.svg' |  asset_url}}"
                  width="20"
                  height="20"
                  alt=""></a>
            {% endif %}

            {% for part in paginate.parts %}
              {% if part.is_link %}
                <a href="{{ part.url }}">{{ part.title }}</a>
              {% else %}
                <span class="current">{{ part.title }}</span>
              {% endif %}
            {% endfor %}

            {% if paginate.next %}
              <a
                href="{{ paginate.next.url }}"
                class="next"
                aria-label="Next"><img
                  src="{{'right-arrow.svg' |  asset_url}}"
                  width="20"
                  height="20"
                  alt="Next Page"></a>
            {% endif %}
          </div>
        </div>
      </div>
    {% endpaginate %}
  </div>
</section>

{% section 'bulk-cta' %}